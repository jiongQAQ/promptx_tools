【流程 2-1｜content.json 按章拆分（生成可独立执行的分章 content.chN.json）】

=== 路径定义 ===
<projectRoot> = $(pwd)  # 当前工作目录的绝对路径
使用说明：执行前请确保在项目根目录下运行，所有相对路径将基于此目录解析

目标
1 基于 <projectRoot>/paper/content.json，按顶层章号（如 "1","2","3"...）拆分为多个可独立执行流程 03 的分章文件。
2 每个分章文件都保留完整的顶层结构键（meta、defaults、_templates、promptSnippets、sectionRules、contents），仅将 contents 过滤到该章相关的键：
   - 规则：KEY=="N" 或 KEY 以 "N." 开头 → 归入第 N 章文件
3 输出到 <projectRoot>/paper/splits/（若不存在需创建）。

注意
- 不覆盖 <projectRoot>/paper/content.json；仅写入 <projectRoot>/paper/splits/content.chN.json。
- 保持 figures/tables 的路径不变（如 <projectRoot>/paper/exports/...）；不改名、不改相对路径。
- 若顶层章号不连续（如有 1、3 无 2），照常输出已有章，并在摘要 "missing" 中列出缺失号。

执行步骤
1 校验并解析 <projectRoot>/paper/content.json，确认存在以下顶层字段：
   - docId、meta、defaults、_templates、promptSnippets、sectionRules、contents
   - 若缺失则报错并终止，不落盘任何拆分文件。
2 提取根章集合 ROOTS = 所有 contents 的键中形如 "N"（无点、正整数）的集合，升序排序。
3 对每个 N ∈ ROOTS：
   - 过滤子键 KEYS_N = { k | k=="N" 或 k 以 "N." 开头 }，保持键名与值结构原样拷贝。
   - 生成对象：
     {
       "docId": "<原docId>-chN",
       "meta": <原样>,
       "defaults": <原样>,
       "_templates": <原样>,
       "promptSnippets": <原样>,
       "sectionRules": <原样>,
       "contents": { 仅包含 KEYS_N }
     }
   - 写入 <projectRoot>/paper/splits/content.chN.json（UTF-8）。
4 汇总统计并输出摘要与报告。

（如你必须使用 @tool://json-chapter-splitter）
A) 先写入临时包装文件 <projectRoot>/paper/content.wrapper.json 以适配该工具的输入结构：
   - 将 ROOTS 与其子键转换为 "chapters": [{ "id":"N", "contents":{...} }, ...]
   - 其他顶层信息置于 "meta" 内，确保工具能保留（preserveStructure=true 时）
B) 调用工具拆分（示例）：
{
  "tool_resource": "@tool://json-chapter-splitter",
  "mode": "execute",
  "parameters": {
    "inputFile": "<projectRoot>/paper/content.wrapper.json",
    "outputDir": "<projectRoot>/paper/splits.wrapper",
    "preserveStructure": true
  }
}
C) 将工具输出的每个 wrapper 章节文件再回写为标准分章 content.chN.json（恢复为我方标准 schema）。
D) 清理临时 wrapper 文件与目录。

输出（stdout 单行 JSON）
{
  "status": "success",
  "project": "<projectName>",
  "source": "<projectRoot>/paper/content.json",
  "outDir": "<projectRoot>/paper/splits/",
  "chapters": [
    {"rootId":"1","file":"<projectRoot>/paper/splits/content.ch1.json","nodeCount": <int>},
    {"rootId":"2","file":"<projectRoot>/paper/splits/content.ch2.json","nodeCount": <int>}
  ],
  "missing": []
}

人类可读检查报告
- 源文件：<projectRoot>/paper/content.json
- 发现根章：如 [1,2,3,4,5,6,7,8,9]；缺失章：[]
- 逐章明细：N → 文件名 / nodeCount（包含 N、N.*、N.*.* 的总条数）
- 顶层结构一致性抽查：meta/defaults/_templates/promptSnippets/sectionRules/contents → 通过/失败
- 下一步建议：基于单章文件执行【流程 03｜正文与素材生成】以并行加速

容错
- 若 content.json 非法或缺失关键字段 → 报错并退出，不生成任何分章文件
- 若某章无子键（只含 "N"）仍生成对应文件
- 不修改任何 figures[].imagePath / tables[].dataPath