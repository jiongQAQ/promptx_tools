@startuml
title 健身房预约管理系统数据库整体ER图

entity User {
  * id : BIGINT <<PK>>
  --
  * username : VARCHAR(50)
  * password : VARCHAR(255)
  * email : VARCHAR(100)
  * phone : VARCHAR(20)
  * real_name : VARCHAR(50)
  * gender : VARCHAR(10)
  birth_date : DATE
  * role_id : BIGINT <<FK>>
  avatar_url : VARCHAR(255)
  * status : VARCHAR(20)
  last_login_time : DATETIME
  * create_time : DATETIME
  * update_time : DATETIME
  * is_delete : TINYINT
}

entity Role {
  * id : BIGINT <<PK>>
  --
  * name : VARCHAR(50)
  description : VARCHAR(255)
  permissions : TEXT
  * create_time : DATETIME
  * update_time : DATETIME
  * is_delete : TINYINT
}

entity Venue {
  * id : BIGINT <<PK>>
  --
  * name : VARCHAR(100)
  description : TEXT
  location : VARCHAR(255)
  equipment : TEXT
  * capacity : INT
  * hourly_rate : DECIMAL(10,2)
  * status : VARCHAR(20)
  * create_time : DATETIME
  * update_time : DATETIME
  * is_delete : TINYINT
}

entity Reservation {
  * id : BIGINT <<PK>>
  --
  * user_id : BIGINT <<FK>>
  * venue_id : BIGINT <<FK>>
  * start_time : DATETIME
  * end_time : DATETIME
  * total_fee : DECIMAL(10,2)
  * status : VARCHAR(20)
  qr_code : VARCHAR(255)
  check_in_time : DATETIME
  remark : TEXT
  * create_time : DATETIME
  * update_time : DATETIME
  * is_delete : TINYINT
}

entity Course {
  * id : BIGINT <<PK>>
  --
  * name : VARCHAR(100)
  description : TEXT
  * instructor_id : BIGINT <<FK>>
  * venue_id : BIGINT <<FK>>
  * start_time : DATETIME
  * end_time : DATETIME
  * max_participants : INT
  * current_participants : INT
  * fee : DECIMAL(10,2)
  * status : VARCHAR(20)
  * level : VARCHAR(20)
  category : VARCHAR(50)
  * create_time : DATETIME
  * update_time : DATETIME
  * is_delete : TINYINT
}

entity MembershipCard {
  * id : BIGINT <<PK>>
  --
  * user_id : BIGINT <<FK>>
  * card_type : VARCHAR(20)
  * card_number : VARCHAR(50)
  remaining_sessions : INT
  * start_date : DATE
  * end_date : DATE
  * status : VARCHAR(20)
  * purchase_price : DECIMAL(10,2)
  description : TEXT
  * create_time : DATETIME
  * update_time : DATETIME
  * is_delete : TINYINT
}

entity CheckIn {
  * id : BIGINT <<PK>>
  --
  * user_id : BIGINT <<FK>>
  reservation_id : BIGINT <<FK>>
  course_id : BIGINT <<FK>>
  * check_in_type : VARCHAR(20)
  * check_in_time : DATETIME
  qr_code : VARCHAR(255)
  location : VARCHAR(100)
  device_info : VARCHAR(255)
  * status : VARCHAR(20)
  remark : TEXT
  * create_time : DATETIME
  * update_time : DATETIME
  * is_delete : TINYINT
}

entity QrCode {
  * id : BIGINT <<PK>>
  --
  * code_content : TEXT
  * code_type : VARCHAR(20)
  * related_id : BIGINT
  * related_type : VARCHAR(20)
  expire_time : DATETIME
  * status : VARCHAR(20)
  scan_count : INT
  last_scan_time : DATETIME
  image_url : VARCHAR(255)
  * create_time : DATETIME
  * update_time : DATETIME
  * is_delete : TINYINT
}

' 关系定义
User ||--o{ Role : belongs_to
User ||--o{ Reservation : makes
User ||--o{ MembershipCard : owns
User ||--o{ CheckIn : performs
User ||--o{ Course : instructs

Venue ||--o{ Reservation : reserves
Venue ||--o{ Course : hosts

Reservation ||--o| CheckIn : triggers
Course ||--o{ CheckIn : attendance

QrCode ||--o| Reservation : generates_for
QrCode ||--o| Course : generates_for
QrCode ||--o| CheckIn : scanned_by

@enduml