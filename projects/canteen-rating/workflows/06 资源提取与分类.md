# 📌 资源提取与分类

## 路径规范
projectRoot 取当前工作目录（pwd）的绝对路径

## 功能说明
- 使用 06-asset-extractor 工具从 chapters/ 目录下的章节文件中提取包含图片和表格路径的内容块
- 实现路径变量解析，将变量路径转换为实际物理路径
- 生成资源索引文件，为后续工作流提供统一的资源查询接口

## 工具调用
使用 06-asset-extractor 工具提取资源相关内容：
- 输入目录：<projectRoot>/paper/chapters/
- 输入文件：chapter.*.json（由 04 工作流生成）
- 路径配置：<projectRoot>/paper/path-config.json
- 输出文件：<projectRoot>/paper/assets/resource-index.json
- 支持变量路径解析（如 ${uml}/activity-auth.png）

## 处理流程

### 执行前提
- **必须先执行 04 章节切割工作流**，生成 chapters/ 目录下的 chapter.*.json 文件
- 确保 path-config.json 配置文件存在

### 处理步骤
1. **扫描章节文件**：遍历 `<projectRoot>/paper/chapters/` 目录下所有 chapter.*.json 文件
2. **字段提取**：从每个文件中提取 imagePath、imagePathSequence、tablePath 字段
3. **路径解析**：将变量路径（如 `${uml}/activity-auth.png`）转换为物理路径
4. **存在性检查**：检查对应的物理文件是否已存在
5. **索引生成**：生成统一的 resource-index.json 文件

### 与其他工作流的关系
- **依赖关系**：06 → 04（必须在04之后执行）
- **输出用途**：07工作流可以利用resource-index.json实现快速处理（可选）
- **独立性**：07也可以直接扫描chapters/目录，不强依赖06的输出

## 处理对象
### 图片资源块（imagePath/imagePathSequence）
- 包含 imagePath 或 imagePathSequence 字段的内容条目
- 解析变量路径（如 `${uml}/activity-auth.png`）
- 记录逻辑路径和物理路径的映射关系

### 表格资源块（tablePath）
- 包含 tablePath 字段的内容条目
- 解析变量路径（如 `${tables}/Tab-users.json`）
- 检查物理文件是否存在

## 输出结构
```
<projectRoot>/paper/assets/
└── resource-index.json      # 资源索引文件
```

### resource-index.json 格式：
```json
{
  "images": [
    {
      "id": "3.2",
      "type": "uml",
      "logicalPath": "${uml}/software-architecture.png",
      "physicalPath": "paper/assets/diagrams/uml/software-architecture.png",
      "exists": false,
      "title": "软件逻辑架构"
    }
  ],
  "tables": [
    {
      "id": "3.4.1.1",
      "logicalPath": "${tables}/Tab-users.json",
      "physicalPath": "paper/assets/tables/Tab-users.json",
      "exists": true,
      "title": "用户表设计"
    }
  ],
  "summary": {
    "totalImages": 15,
    "totalTables": 8,
    "missingFiles": 5
  }
}
```

## 错误处理
- **前置条件检查**：确保 chapters/ 目录存在且包含 chapter.*.json 文件
- **JSON 格式验证**：如遇到格式错误，检查具体的 chapter.*.json 文件
- **路径配置检查**：确保 path-config.json 存在且格式正确
- **输出权限验证**：确保 paper/assets/ 目录有写入权限
- **文件数量验证**：验证提取的资源数量是否符合预期

## 预期输出
- 生成统一的资源索引文件
- 提供逻辑路径与物理路径的映射
- 自动检查文件存在性，标记缺失的资源
- 为后续工作流提供统一的资源查询接口

## 使用场景
- 路径变量解析和验证
- 资源文件存在性检查
- 为后续工具提供资源定位服务
- 支持路径配置的统一管理体系