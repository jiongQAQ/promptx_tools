# 🚀 05流程Hook机制启动指南

## 初始化Hook状态

### 第一步：检查chapter目录
```bash
ls <projectRoot>/paper/chapter/ | wc -l
# 确认章节文件数量
```

### 第二步：创建进度跟踪文件
创建 `<projectRoot>/paper/.chapter-progress.json`：
```json
{
  "currentBatch": 1,
  "totalBatches": 0,
  "processed": [],
  "pending": [],
  "failed": [],
  "lastUpdate": "2025-09-26T15:30:00Z",
  "batchSize": 4,
  "initialized": false
}
```

### 第三步：扫描并初始化章节列表
AI需要执行以下操作：
1. 读取chapter目录中所有 `chapter.*.json` 文件
2. 按章节编号排序（0, 0.1, 0.2, 1, 1.1, 1.1.1...）
3. 将所有章节ID添加到 `pending` 数组
4. 计算总批次数 `totalBatches = Math.ceil(pending.length / batchSize)`
5. 设置 `initialized: true`

## Hook驱动指令

### 🎯 启动指令
```
开始05流程：正文内容生成
```

**AI执行操作**：
1. 检查并创建 `.chapter-progress.json` 状态文件
2. 扫描chapter目录，初始化章节列表
3. 处理第一批章节（3-5个）
4. 更新进度状态
5. 输出继续提示

### 🔄 继续指令
```
继续05流程：处理下一批章节内容生成
```

**AI执行操作**：
1. 读取当前进度状态
2. 获取下一批待处理章节
3. 逐个生成text内容
4. 更新进度状态
5. 输出下一轮提示或完成报告

### ✅ 状态查询指令
```
查看05流程进度
```

**AI返回信息**：
- 当前进度百分比
- 已完成章节数量
- 当前处理批次
- 剩余章节数量
- 失败章节列表

## 批次处理示例

### 第一批处理示例
```
🚀 开始05流程：正文内容生成

📊 初始化完成：
- 发现章节文件：54个
- 分批策略：每批4个章节
- 预计批次：14批

🔄 处理第1批章节：
1. chapter.0.json (摘要) ✅ 生成500字
2. chapter.0.1.json (关键词) ✅ 生成100字
3. chapter.0.2.json (Abstract) ✅ 生成400字
4. chapter.0.3.json (Keywords) ✅ 生成80字

📈 进度更新：4/54 (7.4%)

继续05流程：处理下一批章节内容生成
```

### 中间批次处理示例
```
🔄 继续处理第7批章节：

当前批次内容：
1. chapter.3.4.1.json (用户实体) ✅ 生成580字
2. chapter.3.4.2.json (食堂实体) ✅ 生成520字
3. chapter.3.4.3.json (档口实体) ✅ 生成480字
4. chapter.3.4.4.json (菜品实体) ✅ 生成510字

📈 进度更新：28/54 (51.9%)

继续05流程：处理下一批章节内容生成
```

### 完成示例
```
🎉 05流程完成！

📊 最终统计：
✅ 成功处理：54个章节
❌ 处理失败：0个章节
📝 总生成字数：约27,500字
⏱️ 总处理时间：约45分钟（14轮）

所有章节的text字段已填充完成，可以继续下一步工作流程。
```

## 异常处理

### 如果处理中断
1. 重新启动：`继续05流程：处理下一批章节内容生成`
2. AI会自动从上次中断点继续
3. 已处理的章节不会重复处理

### 如果某个章节处理失败
1. 该章节会被标记到 `failed` 数组
2. 继续处理其他章节
3. 最后可以单独重新处理失败的章节

### 重置进度（重新开始）
删除 `.chapter-progress.json` 文件，然后重新执行启动指令。

## 使用技巧

1. **最佳时机**：建议在AI处理能力较好的时段进行
2. **保存进度**：每几批处理后建议备份chapter目录
3. **质量检查**：定期抽查生成内容的质量
4. **批次调整**：可以根据章节复杂度调整 `batchSize`