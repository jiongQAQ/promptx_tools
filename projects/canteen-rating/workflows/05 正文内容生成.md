# 📌 正文内容生成

## 路径规范
projectRoot 取当前工作目录（pwd）的绝对路径

## 功能说明
- 基于 chapter/ 目录中已拆分的章节内容，根据 prompt 字段生成对应的 text 正文内容
- 识别 word_limit 字段控制生成内容的字数长度
- 仅处理正文内容生成，图表资源默认存在（后续单独处理）
- 不生成新文件，直接更新原有章节文件中的 text 字段

## 处理逻辑

### 字数控制策略
- **存在 word_limit 字段**：按照指定字数生成内容（允许 ±10% 浮动）
- **不存在 word_limit 字段**：默认生成 500 字左右
- **章节层级自适应**：
  - 一级章节（如 "第1章"）：800-1000 字
  - 二级章节（如 "1.1"）：600-800 字
  - 三级章节（如 "1.1.1"）：400-600 字
  - 四级及以下：300-500 字

### 内容生成原则
1. **基于 prompt 字段**：严格按照 prompt 中的写作要求生成内容
2. **保持学术风格**：使用学术化表达，逻辑清晰，层次分明
3. **上下文连贯**：考虑章节在整体论文中的位置和作用
4. **技术准确性**：确保技术描述准确，符合软件工程规范
5. **内容完整性**：覆盖 prompt 中要求的所有要点

### 特殊处理规则
- **包含 imagePath 的章节**：
  - 生成时假设图片存在且内容丰富
  - 在正文中自然引用图片："如图X所示..."
  - 描述图片表达的核心概念和关系

- **包含 tablePath 的章节**：
  - 生成时假设表格数据完整
  - 在正文中分析表格内容："表X展示了..."
  - 解读表格数据的意义和设计合理性

- **代码实现章节**：
  - 结合项目源码特点描述实现细节
  - 突出技术选型和架构优势
  - 说明关键功能的实现思路

## 处理流程
1. **扫描 chapter 目录**：遍历所有 chapter.*.json 文件
2. **内容分析**：读取每个文件的 id、title、prompt、word_limit 字段
3. **字数计算**：根据章节层级和 word_limit 确定目标字数
4. **正文生成**：基于 prompt 生成符合要求的 text 内容
5. **文件更新**：将生成的 text 内容写回原文件
6. **质量检查**：验证生成内容的字数和质量

## 输入源文件
```
<projectRoot>/paper/chapter/
├── chapter.0.json          # 摘要
├── chapter.1.json          # 第1章 绪论
├── chapter.1.1.json        # 研究背景与意义
├── chapter.1.1.1.json      # 研究背景
├── chapter.2.2.3.json      # 用例分析
├── chapter.3.2.json        # 系统软件逻辑架构
└── ...
```

## 处理示例

### 输入文件内容（chapter.1.1.1.json）
```json
{
  "id": "1.1.1",
  "title": "研究背景",
  "prompt": "请基于源码和论文主题，撰写《研究背景》的正文，要求学术化表达，结合实际应用场景，扩展说明校园食堂管理现状与问题，确保涵盖 text 中的要点，字数参考 length.target 配置。",
  "word_limit": 600
}
```

### 输出文件内容
```json
{
  "id": "1.1.1",
  "title": "研究背景",
  "text": "随着我国高等教育事业的快速发展，高校规模不断扩大，在校师生数量持续增长。校园食堂作为师生日常生活的重要服务场所，其服务质量直接关系到师生的生活满意度和身心健康。然而，传统的食堂管理模式普遍存在信息化程度不高、服务反馈机制不完善等问题...",
  "prompt": "请基于源码和论文主题，撰写《研究背景》的正文，要求学术化表达，结合实际应用场景，扩展说明校园食堂管理现状与问题，确保涵盖 text 中的要点，字数参考 length.target 配置。",
  "word_limit": 600
}
```

## 质量标准
- **字数符合要求**：生成内容字数在目标范围内（允许 ±10% 浮动）
- **逻辑结构清晰**：段落层次分明，论述逻辑严密
- **学术表达规范**：用词准确，符合学术论文写作规范
- **内容充实完整**：覆盖 prompt 要求的所有关键点
- **技术描述准确**：涉及技术内容时保证准确性和专业性

## 注意事项
- **保留原有字段**：仅更新 text 字段，保持其他字段不变
- **备份重要数据**：处理前建议备份 chapter 目录
- **批量处理顺序**：按章节编号顺序处理，保持内容连贯性
- **错误处理**：遇到无法处理的文件时跳过并记录日志
- **进度跟踪**：显示处理进度和已完成的章节数量

## 预期成果
- 所有章节文件的 text 字段被填充完整
- 生成内容符合学术论文标准
- 字数控制精确，符合各章节要求
- 内容逻辑清晰，技术描述准确
- 为后续的图表处理和整体论文生成打下基础