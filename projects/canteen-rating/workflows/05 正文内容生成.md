# 📌 正文内容生成

## 章节专注处理架构

### 🎯 设计原理
本工作流程实现章节专注处理模式：

- **专注机制**：单章节专注处理，确保内容质量和深度
- **批次处理**：支持按批次处理多个章节
- **状态管理**：支持处理进度跟踪和中断恢复

### 📊 章节处理特性
- **单任务专注**：每次专注处理一个或少数几个章节，避免分心
- **状态持久化**：进度保存和跟踪支持
- **智能处理**：根据章节特点调整处理策略
- **质量保证**：专注当下任务，确保内容质量

## 路径规范
projectRoot 取当前工作目录（pwd）的绝对路径

## 章节内容生成要求

### 核心任务
专注处理章节内容生成，完成content字段内容生成：
- **首先激活promptx的pra角色**进行专业化内容生成
- **专注当前章节**：专注处理指定的章节，确保内容质量
- 严格按照该章节的prompt字段要求生成内容
- 遵守该章节的word_limit字数限制（允许±10%浮动）
- 仅更新该章节的content字段，保持其他字段不变（text字段可保留不动）
- 使用Edit工具直接修改对应的JSON文件
- **完成即结束**：处理完当前章节后简单报告完成

## 处理逻辑

### 字数控制策略
- **存在 word_limit 字段**：按照指定字数生成内容（允许 ±10% 浮动）
- **不存在 word_limit 字段**：默认生成 500 字左右
- **章节层级自适应**：
  - 一级章节（如 "第1章"）：800-1000 字
  - 二级章节（如 "1.1"）：600-800 字
  - 三级章节（如 "1.1.1"）：400-600 字
  - 四级及以下：300-500 字

### 内容生成原则
1. **激活pra角色**：在开始每批处理前先激活promptx的pra角色
2. **基于 prompt 字段**：严格按照 prompt 中的写作要求生成内容
3. **保持学术风格**：使用学术化表达，逻辑清晰，层次分明
4. **上下文连贯**：考虑章节在整体论文中的位置和作用
5. **技术描述规范**：确保技术描述准确但避免过度技术化
6. **内容完整性**：覆盖 prompt 中要求的所有要点

### 特殊处理规则
- **包含 imagePath 的章节**：
  - 生成时假设图片存在且内容丰富
  - 在正文中自然引用图片："如图X所示..."
  - 描述图片表达的核心概念和关系

- **包含 tablePath 的章节**：
  - 生成时假设表格数据完整
  - 在正文中分析表格内容："表X展示了..."
  - 解读表格数据的意义和设计合理性

- **系统实现相关章节**：
  - **严格避免代码片段**：不包含任何源代码、配置文件内容
  - **不提及文件路径**：避免具体的代码文件路径或目录结构描述
  - **专注功能描述**：从用户角度描述系统功能特点和使用体验
  - **突出设计思想**：强调架构理念、技术选型的合理性和优势
  - **业务价值导向**：重点说明功能对实际应用场景的解决方案

## 章节处理流程

### 处理流程
1. **状态初始化**：扫描chapters目录，了解待处理章节
2. **章节准备**：根据处理需求准备当前需要处理的章节
3. **内容生成**：为章节生成详细内容
4. **完成标记**：标记章节完成，准备下一批次

### AI执行流程
1. **激活专业角色**：首先激活promptx的pra角色以确保专业化论文写作
2. **接收章节任务**：获取当前需要处理的章节
3. **专注处理当前章节**：
   - 读取该章节JSON文件的prompt、word_limit等信息
   - 根据本文档的内容生成原则为该章节创建content内容
   - **严格遵守无代码原则**：生成的内容不包含代码片段和文件路径
   - 使用Edit工具更新该章节对应的JSON文件
4. **完成报告**：处理完成后简单说明已完成该章节

## 输入源文件
```
<projectRoot>/paper/chapter/
├── chapter.0.json          # 摘要
├── chapter.1.json          # 第1章 绪论
├── chapter.1.1.json        # 研究背景与意义
├── chapter.1.1.1.json      # 研究背景
├── chapter.2.2.3.json      # 用例分析
├── chapter.3.2.json        # 系统软件逻辑架构
└── ...
```

## 批次处理示例

### 章节处理示例
AI处理单个章节的流程：

**输入**：chapter.1.1.1.json
```json
{
  "id": "1.1.1",
  "title": "研究背景",
  "prompt": "请基于源码和论文主题，撰写《研究背景》的正文...",
  "word_limit": 600
}
```

**AI执行**：
1. 激活promptx的pra角色进行专业论文写作
2. 阅读prompt要求和word_limit限制
3. 按照本文档的内容生成原则创建600字左右的学术化内容
4. 严格避免代码片段和文件路径描述
5. 使用Edit工具更新JSON文件，仅添加content字段

**输出**：chapter.1.1.1.json
```json
{
  "id": "1.1.1",
  "title": "研究背景",
  "content": "随着我国高等教育事业的快速发展，高校规模不断扩大，在校师生数量持续增长。校园食堂作为师生日常生活的重要服务场所，其服务质量直接关系到师生的生活满意度和身心健康。然而，传统的食堂管理模式普遍存在信息化程度不高、服务反馈机制不完善等问题...",
  "prompt": "请基于源码和论文主题，撰写《研究背景》的正文...",
  "word_limit": 600
}
```

## 质量标准
- **字数符合要求**：生成内容字数在目标范围内（允许 ±10% 浮动）
- **逻辑结构清晰**：段落层次分明，论述逻辑严密
- **学术表达规范**：用词准确，符合学术论文写作规范
- **内容充实完整**：覆盖 prompt 要求的所有关键点
- **技术描述准确**：涉及技术内容时保证准确性和专业性

## AI执行注意事项

### 章节处理要求
- **专注当前章节**：专注处理当前章节，不询问或考虑其他章节
- **仅更新content字段**：保持JSON文件的其他字段完全不变
- **工具使用**：使用Edit工具更新当前章节对应的JSON文件
- **文件操作**：直接修改chapters目录下对应的JSON文件，不创建新文件
- **完成即结束**：处理完当前章节后简单报告

### 内容生成规范
- **prompt优先**：严格按照每个章节的prompt字段要求生成内容
- **字数控制**：遵守word_limit限制，允许±10%浮动
- **质量标准**：按照本文档的内容生成原则和质量标准执行
- **连贯性**：考虑章节在整体论文中的位置和上下文关系

### 章节完成流程
1. **专注处理**：专注处理当前章节
2. **文件更新**：处理完成后立即更新对应的JSON文件
3. **简单报告**：说明该章节已完成，无需询问后续步骤

## 工作流程优势

### 专注处理
- **章节专注**：避免分心，每次专注处理一个或少数几个章节
- **质量保证**：专注处理确保内容质量和深度
- **状态管理**：支持处理进度跟踪和中断恢复
- **错误隔离**：单个章节问题不影响整体流程