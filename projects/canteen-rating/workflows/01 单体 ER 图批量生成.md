# 01 单体 ER 图批量生成

## 路径规范
projectRoot 取当前工作目录（pwd）的绝对路径

## 功能说明
基于已生成的三线表JSON文件，批量生成单体ER图SVG文件，为论文数据库设计章节提供可视化图表支撑。

## 目标任务
1. **扫描三线表文件**：扫描 `<projectRoot>/paper/exports/tables/` 目录下全部 Tab-*.json（来自【07｜实体类识别与三线表生成】）
2. **批量生成ER图**：逐个调用工具 @tool://1-1-single-er 将每个 JSON 转换为同名 SVG 单体 ER 图：
   - 输入：Tab-<tableName>.json
   - 输出：Tab-<tableName>.svg（与 JSON 同目录、同名，仅后缀不同）
3. **生成报告**：生成机器可读摘要 + 人类可读报告

## 前置条件
- 目录 `<projectRoot>/paper/exports/tables/` 存在，且包含 ≥1 个 Tab-*.json
- 每个 JSON 满足格式：
```json
{
  "tableName": "check_in",
  "tableCnName": "签到表",
  "columns": [
    ["字段名","字段中文名","类型","约束","说明"],
    ["id","签到编号","BIGINT","PK, AUTO_INCREMENT, NOT NULL","签到记录主键ID"],
    ...
  ]
}
```

## 执行要求
1. 严禁修改 JSON 原文件；SVG 必须与 JSON 同目录、同名（仅扩展名 .svg）
2. 若某 JSON 无法解析或生成失败，应继续处理其他文件，并在报告 failList 中记录
3. 支持中文表名/字段名；要求边到边精确连线

## 工具调用方式

### 逐文件调用模版
```json
{
  "tool_resource": "@tool://1-1-single-er",
  "parameters": {
    "inputPath": "<projectRoot>/paper/exports/tables/Tab-<tableName>.json"
  }
}
```
⚠️ 重要：inputPath必须是绝对路径，例如："/Users/pc/Documents/project/paper/exports/tables/Tab-user.json"

### 目录批量调用（推荐）
```json
{
  "tool_resource": "@tool://1-1-single-er",
  "parameters": {
    "inputPath": "<projectRoot>/paper/exports/tables"
  }
}
```
⚠️ 重要：inputPath必须是绝对路径，例如："/Users/pc/Documents/project/paper/exports/tables"

## 输出结构

### 机器可读JSON摘要（stdout 单行）
```json
{
  "status": "success",
  "project": "<projectName>",
  "tablesDir": "<projectRoot>/paper/exports/tables/",
  "jsonCount": <int>,
  "svgGenerated": <int>,
  "failList": [
    {"file":"Tab-xxx.json","reason":"parse error"},
    {"file":"Tab-yyy.json","reason":"render timeout"}
  ]
}
```

### 人类可读检查报告
- 扫描目录：`<projectRoot>/paper/exports/tables/`
- 发现 JSON：N 个；生成 SVG：M 个；失败：K 个
- 成功清单（前若干个）：Tab-*.svg
- 失败清单：文件名 + 原因
- 下一步建议：进入【流程 02】预填 content.json（将 figures[].imagePath 指向这些 SVG）

## 输出文件规范
- **存放路径**：与输入JSON同目录 `<projectRoot>/paper/exports/tables/`
- **文件命名**：Tab-<tableName>.svg（与JSON文件同名，仅扩展名不同）
- **图形格式**：SVG矢量图，支持缩放和编辑

## 使用场景
- 论文数据库设计章节的ER图生成
- 系统分析阶段的数据模型可视化
- 数据库文档的图表自动化生成
- 技术文档的标准化输出

## 前置条件检查
- 执行前请确保在项目根目录下运行
- 确认已完成【07｜实体类识别与三线表生成】流程
- 验证三线表JSON文件格式正确

## 下一步流程
生成完成后，可进入后续的内容规划或正文生成流程，将生成的SVG文件路径集成到论文图表引用中。