{
  "id": "4.2.2",
  "title": "逻辑结构设计",
  "text": "数据库逻辑设计阶段将概念模型转换为关系模型，确定表结构、字段类型、主键、外键和索引。系统共包含7张核心表：user（用户表）、canteen（食堂表）、stall（档口表）、dish（菜品表）、rating（评价表）、complaint（投诉表）、sensitive_word（敏感词表）。各表之间通过外键建立关系：stall.canteen_id关联canteen.id，dish.stall_id关联stall.id，rating.user_id关联user.id，rating.dish_id关联dish.id，complaint.user_id关联user.id。所有表均使用BIGINT类型的自增主键id，包含create_time、update_time和is_deleted等审计字段，支持MyBatis Plus的逻辑删除功能。为提升查询性能，在外键字段和常用查询字段（如username、status）上建立普通索引。总体ER图展示了所有实体及其关系，如下图所示。",
  "word_limit": 300,
  "imagePath": "${uml}/er-overall.png",
  "content": "数据库逻辑设计阶段的主要任务是将概念模型转换为特定数据库管理系统支持的逻辑模型，即关系模型。在这个阶段，需要确定每个实体对应的数据表结构，包括表名、字段名称、字段数据类型、主键、外键、索引等，并确保数据的完整性和一致性。\n\n本系统使用MySQL作为数据库管理系统，采用关系模型组织数据。系统共设计了7张核心数据表，分别对应概念设计阶段识别的7个实体：用户表（user）、食堂表（canteen）、档口表（stall）、菜品表（dish）、评价表（rating）、投诉表（complaint）和敏感词表（sensitive_word）。\n\n在表结构设计上，所有数据表遵循统一的设计规范。每张表都使用BIGINT类型的自增字段id作为主键，确保主键的唯一性和性能。表名采用小写字母加下划线的命名方式，字段名也采用小写字母加下划线的命名方式，符合数据库命名规范。所有表都包含create_time、update_time和is_deleted三个审计字段，create_time字段记录数据创建时间，采用DATETIME类型，默认值为CURRENT_TIMESTAMP；update_time字段记录数据最后修改时间，采用DATETIME类型，设置为ON UPDATE CURRENT_TIMESTAMP自动更新；is_deleted字段用于逻辑删除，采用TINYINT(1)类型，默认值为0表示未删除，1表示已删除，配合MyBatis Plus的@TableLogic注解实现逻辑删除功能。\n\n各表之间通过外键建立关系，保证数据的引用完整性。档口表（stall）通过canteen_id字段关联食堂表（canteen）的主键id，表示档口所属的食堂。菜品表（dish）通过stall_id字段关联档口表（stall）的主键id，表示菜品所属的档口。评价表（rating）通过user_id字段关联用户表（user）的主键id，通过dish_id字段关联菜品表（dish）的主键id，分别表示评价的发布者和评价对象。投诉表（complaint）通过user_id字段关联用户表（user）的主键id，表示投诉的提交者。这些外键关系确保了数据的一致性，防止了孤立数据的产生。\n\n为了提升数据库查询性能，在设计阶段就需要考虑索引的创建。除了主键id自动创建的聚簇索引外，系统在以下字段上创建了普通索引（B+Tree索引）：在所有外键字段上创建索引，如stall表的canteen_id、dish表的stall_id、rating表的user_id和dish_id、complaint表的user_id等，加速关联查询；在常用查询条件字段上创建索引，如user表的username、status字段，canteen表的status字段，dish表的status和category字段等，提升条件查询的效率；在需要排序的字段上创建索引，如rating表的create_time字段，加速按时间排序的查询。对于某些频繁组合查询的场景，考虑创建联合索引，如（status, create_time）联合索引，支持按状态筛选并按时间排序的查询。\n\n数据库设计遵循关系型数据库的规范化理论，主要达到第三范式（3NF）。第一范式（1NF）要求每个字段都是不可再分的原子值，表中不存在重复的列；第二范式（2NF）要求非主键字段完全依赖于主键，不存在部分依赖；第三范式（3NF）要求非主键字段不存在传递依赖，即非主键字段之间不存在依赖关系。规范化设计消除了数据冗余，避免了更新异常、插入异常和删除异常，提高了数据的一致性和完整性。\n\n系统整体的实体关系图（ER图）如图所示，完整展示了所有实体及其之间的关系，为后续的物理设计和数据库实现提供了清晰的蓝图。",
  "sourceFile": "chapter.4.2.2.json",
  "extractedAt": "2025-09-30T10:25:51.840Z"
}