{
  "id": "4.1.2",
  "title": "菜品评分管理的详细设计",
  "text": "设计菜品浏览、评分提交、评价展示的业务流程，包括评分算法、数据验证、重复评分控制等核心逻辑的实现。",
  "imagePath": "/Users/jiongjiong/Documents/a_git_project/promptx_tools/projects/canteen-rating/paper/pngs/activity-dish-rating.png",
  "imagePathSequence": "/Users/jiongjiong/Documents/a_git_project/promptx_tools/projects/canteen-rating/paper/pngs/sequence-dish-rating.png",
  "prompt": "请基于源码和论文主题，撰写《菜品评分管理的详细设计》的正文，要求学术化表达，详细设计菜品评分的业务逻辑和算法实现，并在正文中结合活动图描述评分流程的业务规则和数据处理过程，同时结合时序图说明用户评分操作中前端、后端、数据库之间的交互时序和数据流转过程，确保涵盖text中的要点，字数参考word_limit配置。",
  "word_limit": 400,
  "content": "菜品评分管理模块采用事务性业务流程设计，确保评分数据的一致性和完整性，如菜品评分活动图所示。在菜品浏览阶段，系统通过DishController提供RESTful API接口，支持分页查询、条件筛选、排序等功能。查询逻辑采用MyBatis Plus的条件构造器实现动态SQL生成，支持按档口、分类、价格区间、评分范围等多维度筛选。菜品信息展示包含基本属性（名称、价格、描述）、统计信息（平均评分、评价数量）和用户历史评分状态。在评分提交阶段，业务流程首先进行用户身份验证，通过JWT Token解析用户ID；然后进行重复评分检查，查询ratings表中是否存在相同user_id和dish_id的记录，实现一人一菜一评分的业务规则；接着进行评分值验证，确保评分在1-5范围内且为有效数值；通过验证后，系统开启数据库事务，同时执行评分记录插入和菜品平均分更新操作。评分算法采用实时计算策略，使用SQL聚合函数计算平均值：AVG(rating_value) FROM ratings WHERE dish_id = ? AND deleted = 0。为提升性能，系统采用乐观锁机制处理并发评分，通过版本号字段防止更新冲突。在评价展示阶段，系统提供多种展示模式：列表模式显示最新评价和热门评价，统计模式显示评分分布和趋势分析，个人模式显示用户历史评价记录。数据验证包括前端表单验证和后端业务验证双重保障，前端使用Element Plus的表单验证规则，后端使用Hibernate Validator注解进行参数校验。异常处理机制包括重复评分异常、数据验证异常、数据库操作异常等场景的处理逻辑，确保系统的健壮性和用户体验。",
  "sourceFile": "chapter.4.1.2.json",
  "extractedAt": "2025-09-28T03:11:38.495Z"
}