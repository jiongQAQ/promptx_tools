{
  "id": "5.5.2",
  "title": "实现过程",
  "text": "投诉管理模块的后端实现在投诉控制器中，提供用户投诉接口和管理员处理接口。用户提交投诉时，服务实现类保存投诉信息，初始状态为待处理，同时发送通知给相关管理员（可通过邮件或站内消息）。管理员查询投诉列表时，支持按状态、类型、时间范围筛选，按优先级排序。处理投诉时，管理员填写处理结果，更新状态为已处理，记录处理时间，系统计算处理时长。前端用户界面使用表单组件实现投诉提交表单，选择器组件选择投诉类型，上传组件上传图片。投诉列表使用卡片组件展示投诉卡片，按时间倒序排列，标识状态（待处理/已处理）。管理员界面使用表格组件展示投诉列表，抽屉组件展示投诉详情和处理表单。实现效果如图所示。",
  "word_limit": 300,
  "imagePath": "${impl}/impl-complaint.png",
  "content": "投诉管理模块的实现重点在于状态流转机制和通知功能，确保投诉能够得到及时有效的处理和反馈。\n\n后端实现在投诉控制器中，提供用户投诉接口和管理员处理接口。用户提交投诉接口接收投诉数据传输对象，包含投诉类型、投诉对象ID（可能是食堂ID或档口ID）、投诉内容、图片URL数组等。在服务实现类中，验证投诉内容不少于20字，验证图片数量不超过5张，验证投诉对象ID存在。创建投诉实体对象，设置初始状态为待处理，保存到数据库。保存成功后，触发通知逻辑，向相关管理员发送通知。通知可以通过多种方式实现：站内消息通知，在系统内创建一条消息记录，管理员登录后可见；邮件通知，使用Spring Boot的邮件发送器发送邮件到管理员邮箱；WebSocket推送，实时推送通知到管理员在线的浏览器页面。本系统实现了站内消息通知，通过消息服务创建通知消息。\n\n管理员查询投诉列表接口支持多维度筛选。使用查询构造器构造查询条件：按状态筛选、按类型筛选、按时间范围筛选、按优先级排序，优先显示最新投诉。返回分页对象包含投诉列表和分页信息，投诉列表的视图对象中关联查询用户昵称、投诉对象名称等信息，方便管理员快速了解情况。\n\n管理员处理投诉接口接收投诉ID和处理结果数据对象（包含处理结果文字和处理意见）。在服务层，先查询投诉记录验证存在且未处理，然后更新投诉状态为已处理，记录处理结果、处理时间，计算处理时长。更新成功后，向投诉用户发送处理完成通知，通知内容包括投诉编号、处理结果摘要、处理时间等。\n\n前端用户界面实现分为投诉提交页和投诉历史页。投诉提交页使用表单组件构建表单，包含投诉类型选择器（选项为预定义的类型列表）、投诉对象选择器（级联选择，先选食堂再选档口）、投诉内容输入（文本域组件，配置最小长度为20，最大长度为500，显示字数）、图片上传（上传组件，限制为5张，列表类型为卡片形式）。表单配置验证规则，必填项使用必填标记，内容长度使用最小值和最大值限制。点击提交按钮时，使用表单的验证方法验证表单，验证通过后发送请求，使用加载状态防止重复提交，成功后显示投诉编号，跳转到投诉历史页。\n\n投诉历史页使用卡片组件展示投诉卡片列表，每个卡片显示投诉编号、类型、状态、提交时间、处理结果（如果已处理）。状态使用标签组件，不同状态显示不同颜色：待处理为橙色，处理中为蓝色，已处理为绿色。点击卡片展开详情，显示完整的投诉内容和证据图片，图片使用图片组件支持点击预览。如果投诉已处理，显示处理结果和处理时间。\n\n管理员处理界面使用表格组件展示投诉列表，配置筛选表单实现多维度查询。表格列包括投诉编号、用户昵称、投诉类型、投诉对象、提交时间、状态、操作等。点击处理按钮，使用抽屉组件从右侧滑出，宽度设为50%。抽屉内上半部分展示投诉详细信息，包括完整的投诉内容和图片，图片使用图片组件展示，支持大图预览。下半部分是处理表单，管理员填写处理结果，使用文本域组件，字数限制为200-1000字。点击提交处理按钮，调用处理接口，成功后关闭抽屉，刷新列表，投诉状态更新为已处理。\n\n模块实现效果如图所示，展示了用户投诉提交界面、投诉历史页面、管理员投诉列表、投诉详情抽屉和处理结果展示，验证了投诉流程的完整性和状态流转的正确性。",
  "docx_type": "subsection_title",
  "docx_type_text": "body_text",
  "docx_type_desc": "body_text"
}