{
  "id": "5.4.2",
  "title": "实现过程",
  "text": "评价管理模块的后端实现在评价控制器中，提供用户接口和管理员接口两套接口，分别面向用户和管理员。用户提交评价时，服务实现类首先调用敏感词服务检测内容中的敏感词，使用DFA（确定性有限自动机）算法实现高效匹配。检测通过的评价状态设为已发布，否则设为待审核。评价保存后异步更新菜品表的平均分和评价数，使用异步注解实现异步调用。前端用户界面使用评分组件实现星级评分，文本域输入组件输入评价内容，上传组件上传图片。评价列表使用时间轴组件展示时间轴样式，显示用户头像、昵称、评分、内容、图片、时间。管理员审核界面使用表格组件展示待审核评价，提供通过/拒绝操作按钮。实现效果如图所示。",
  "word_limit": 300,
  "imagePath": "${impl}/impl-rating.png",
  "content": "评价管理模块的实现涉及复杂的业务逻辑和性能优化，包括评价提交、敏感词过滤、异步统计、前端交互等多个技术要点。\n\n后端实现在评价控制器中，路径分为用户接口和管理员接口两部分。用户提交评价接口接收评价数据传输对象，包含菜品ID、评分（1-5的整数）、评价内容、图片URL数组等。在服务实现类中，首先验证菜品是否存在且已上架，验证用户是否已经评价过该菜品（一个用户只能评价一个菜品一次）。然后调用敏感词服务的检测方法检测评价内容中的敏感词。敏感词服务使用DFA（确定性有限自动机）算法实现敏感词匹配，该算法将敏感词构建成一棵多叉树，匹配时只需遍历一次文本即可检测所有敏感词，时间复杂度为O(n)，比朴素的多次字符串匹配高效得多。如果检测到敏感词，返回敏感词列表，评价状态设为待审核，否则状态设为已发布。评价保存后，使用异步注解标注的方法异步更新菜品的评分统计，避免阻塞主线程，提升响应速度。异步方法中，使用SQL聚合函数计算平均分和评价数，更新菜品表的对应字段。\n\n管理员审核接口接收审核动作（通过或拒绝），更新评价状态。如果审核通过，状态改为已发布，触发菜品评分的重新统计；如果拒绝，状态改为已拒绝，评价不对外展示。管理员删除评价接口执行逻辑删除，删除后也需要重新统计评分，确保数据准确性。\n\n前端用户界面的实现使用Vue 3组合式API。菜品详情页组件中，使用响应式引用定义响应式变量存储菜品信息和评价列表，使用挂载生命周期钩子加载数据。评价提交对话框使用对话框组件，可见属性控制显示隐藏。评分输入使用评分组件，配置最大值为5，显示分数，双向绑定评分值。评价内容使用文本域输入组件，配置最大长度为500，显示字数统计。图片上传使用上传组件，配置上传接口地址，列表类型为卡片形式展示，限制最多3张，超出钩子提示超出限制。点击提交按钮时，调用Axios发送评价数据，使用异步等待语法简化异步处理，成功后关闭对话框，调用消息提示显示成功提示，刷新评价列表。\n\n评价列表展示使用时间轴组件，每个评价作为一个时间轴项，显示用户头像、昵称、评分（只读）、评价时间（使用日期库格式化）、评价内容、图片（支持预览）。列表支持下拉加载更多，使用交叉观察器API监听滚动到底部，触发下一页数据加载。\n\n管理员审核界面使用表格组件展示待审核评价列表，每行包括用户昵称、菜品名称、评分、评价内容（超长文本省略显示）、提交时间、操作列。操作列提供通过和拒绝按钮，使用确认弹窗组件确认操作，避免误操作。点击查看详情按钮，使用抽屉组件从右侧滑出，显示评价的完整信息和图片，管理员填写审核意见并提交。\n\n模块实现效果如图所示，展示了用户评价提交界面、评价列表展示、敏感词过滤提示、管理员审核界面等关键页面的实际效果，验证了评价管理功能的完整性和易用性。",
  "docx_type": "subsection_title",
  "docx_type_text": "body_text",
  "docx_type_desc": "body_text"
}