{
  "id": "5.6.2",
  "title": "实现过程",
  "text": "系统管理模块的后端实现分布在多个Controller中。AdminController提供用户管理接口，支持分页查询、角色分配、状态更新。SensitiveWordController提供敏感词CRUD接口，使用缓存（Redis或本地缓存）加速敏感词检测。StatisticsController提供统计数据接口，执行复杂的SQL聚合查询，返回时间序列数据和排行榜数据。FileUploadController处理文件上传，使用MultipartFile接收文件，保存到指定目录，返回访问URL。系统日志使用AOP切面实现自动记录，定义@Log注解标注需要记录的方法，切面拦截方法执行，记录操作人、时间、参数、结果。前端使用ECharts的折线图、柱状图、饼图展示统计数据。敏感词管理使用el-table和el-tag展示列表。实现效果如图所示，展示了统计分析仪表盘和敏感词管理界面。",
  "word_limit": 300,
  "imagePath": "${impl}/impl-system-admin.png",
  "content": "系统管理模块的实现分散在多个Controller中，每个Controller负责一类管理功能，通过统一的权限控制确保只有系统管理员可以访问。\n\n在用户管理的后端实现中，AdminController提供/api/admin/user路径下的接口。实现GET接口查询用户列表，支持分页参数和筛选条件（角色、状态、关键词），使用QueryWrapper构造查询，like方法实现模糊搜索，eq方法实现精确匹配。实现PUT /{id}/role接口处理角色分配，接收用户ID和新角色，更新user表的role字段。实现PUT /{id}/status接口处理状态更新，切换用户的启用禁用状态。实现PUT /{id}/reset-password接口重置密码，生成默认密码（如\"123456\"），使用BCrypt加密后更新到数据库，同时设置force_change_password标记，用户下次登录时强制修改密码。\n\n在敏感词管理的后端实现中，SensitiveWordController提供/api/admin/sensitive-word接口。实现标准的CRUD接口，支持敏感词的增删改查。为了提升敏感词检测性能，系统使用缓存技术。在应用启动时，SensitiveWordService从数据库加载所有启用状态的敏感词，构建DFA自动机，存储在内存中。当检测评价内容时，直接使用内存中的DFA进行匹配，避免每次都查询数据库。当管理员新增、修改或删除敏感词时，除了更新数据库，还要清除缓存并重新构建DFA，使用@CacheEvict注解实现缓存失效，@PostConstruct注解的方法在Bean初始化时加载数据。敏感词支持正则表达式匹配，如\"sb+\"可以匹配\"sb\"、\"sbb\"等变形，提高过滤效果。\n\n在统计分析的后端实现中，StatisticsController提供/api/admin/statistics路径下的多个接口。实现用户趋势接口，执行SQL查询SELECT DATE(create_time) as date, COUNT(*) as count FROM user WHERE create_time >= ? GROUP BY DATE(create_time)，返回时间序列数据。实现评价趋势接口，统计每天的评价数量。实现投诉统计接口，使用COUNT(*) GROUP BY status查询各状态投诉数量，计算处理率（已处理数/总数×100%）。实现菜品排行接口，使用ORDER BY avg_score DESC LIMIT 10查询高分菜品，ORDER BY avg_score ASC LIMIT 10查询低分菜品。使用缓存注解@Cacheable缓存统计结果，设置有效期为5分钟，避免频繁执行复杂查询。\n\n在文件管理的实现中，FileUploadController提供/api/common/upload接口处理文件上传。使用MultipartFile接收前端上传的文件，验证文件类型（image/jpeg、image/png等）和大小（不超过5MB）。生成唯一的文件名（UUID+原始扩展名），保存文件到服务器的指定目录（如/uploads/images/），返回文件的访问URL（如http://localhost:8080/uploads/images/xxx.jpg）。配置静态资源映射，使上传的图片可以通过URL直接访问。FileService记录文件的元数据（文件名、大小、上传时间、关联对象），便于后续管理和清理。\n\n在系统日志的实现中，使用AOP（面向切面编程）技术实现操作日志的自动记录。定义@Log自定义注解，包含操作类型（type）和操作描述（desc）属性。定义LogAspect切面类，使用@Around通知拦截标注了@Log注解的方法。在方法执行前记录开始时间，执行后记录结束时间，计算执行耗时。通过反射获取方法参数，从SecurityContext获取当前用户信息，从HttpServletRequest获取IP地址，组装OperationLog实体对象，包含操作时间、操作用户、操作类型、操作描述、请求参数、返回结果、执行耗时、IP地址等。异步保存日志到数据库，避免影响主业务性能。日志查询接口支持多条件组合查询和分页，使用索引优化查询性能。\n\n前端实现使用ECharts图表库进行数据可视化。在统计分析页面，引入echarts库，创建图表容器DOM元素，使用echarts.init初始化图表实例。配置option对象定义图表类型、数据、样式等。折线图用于展示趋势数据，配置xAxis为时间轴，yAxis为数值轴，series为数据系列。柱状图用于展示排行数据，type设置为'bar'。饼图用于展示占比数据，type设置为'pie'，配置label显示百分比。图表支持响应式，监听窗口resize事件调用chart.resize()方法。数据通过Axios从后端API获取，使用onMounted钩子初次加载，提供刷新按钮手动更新数据。\n\n敏感词管理界面使用el-table展示敏感词列表，使用el-tag组件标识敏感词类型，不同类型显示不同颜色。启用状态使用el-switch组件快速切换。新增和编辑敏感词使用el-dialog对话框，表单中包括敏感词内容输入、类型选择、状态设置。\n\n系统日志查询界面提供高级筛选表单，包括用户选择（el-select）、时间范围选择（el-date-picker，type为'datetimerange'）、操作类型选择、关键词搜索。日志列表使用el-table展示，配置stripe斑马纹样式，支持排序和分页。点击日志条目查看详细信息，使用el-descriptions组件展示日志的所有字段，参数和结果使用el-code-preview代码高亮展示。\n\n模块实现效果如图所示，展示了用户管理界面、统计分析仪表盘（包括折线图、柱状图、饼图等多种图表）、敏感词管理列表、系统日志查询界面，验证了系统管理模块的完整性和实用性。"
}