@startuml
skinparam activity {
  BackgroundColor #FFFFFF
  BorderColor #333333
  FontColor #333333
}

skinparam swimlane {
  BorderColor #333333
  TitleFontColor #333333
}

title 菜品信息管理活动图

|管理员|
start
:填写菜品信息表单;
:上传菜品图片(可选);
:提交添加菜品请求;

|系统|
:接收菜品信息;
:验证管理员权限;

if (权限验证通过?) then (否)
  :返回权限不足错误;
  |管理员|
  :显示权限不足提示;
  stop
else (是)
  :验证菜品数据格式;

  if (数据格式正确?) then (否)
    :返回数据格式错误;
    |管理员|
    :显示格式错误提示;
    stop
  else (是)
    if (包含图片上传?) then (是)
      :验证图片格式和大小;
      if (图片验证通过?) then (否)
        :返回图片格式错误;
        |管理员|
        :显示图片错误提示;
        stop
      else (是)
        :保存图片到文件系统;
        :生成图片访问URL;
      endif
    else (否)
      :使用默认图片;
    endif

    :检查档口是否存在;

    |数据库|
    :查询档口信息;

    if (档口存在?) then (否)
      |系统|
      :返回档口不存在错误;
      |管理员|
      :显示档口不存在提示;
      stop
    else (是)
      |系统|
      :检查菜品名称重复;

      |数据库|
      :查询同档口菜品名称;

      if (名称重复?) then (是)
        |系统|
        :返回名称重复错误;
        |管理员|
        :显示名称重复提示;
        stop
      else (否)
        |系统|
        :构建菜品实体对象;
        :设置创建时间和状态;

        |数据库|
        :插入菜品记录;

        if (插入成功?) then (否)
          |系统|
          :返回数据库错误;
          |管理员|
          :显示保存失败提示;
          stop
        else (是)
          |系统|
          :更新档口菜品统计;
          :清除相关缓存;
          :返回成功响应;

          |管理员|
          :显示添加成功消息;
          :刷新菜品列表;
          stop
        endif
      endif
    endif
  endif
endif

@enduml