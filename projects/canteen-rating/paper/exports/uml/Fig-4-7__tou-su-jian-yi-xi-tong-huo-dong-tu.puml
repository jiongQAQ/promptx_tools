@startuml
skinparam activity {
  BackgroundColor #FFFFFF
  BorderColor #333333
  FontColor #333333
}

skinparam swimlane {
  BorderColor #333333
  TitleFontColor #333333
}

title 投诉建议系统活动图

|用户|
start
:选择投诉建议类型;
:填写投诉标题;
:填写详细描述;
:选择相关食堂(可选);
:提交投诉建议;

|系统|
:接收投诉建议;
:验证用户身份;

if (用户已登录?) then (否)
  :返回未登录错误;
  |用户|
  :跳转到登录页面;
  stop
else (是)
  :验证投诉数据格式;

  if (数据格式正确?) then (否)
    :返回数据格式错误;
    |用户|
    :显示格式错误提示;
    stop
  else (是)
    :检查内容长度限制;

    if (内容长度合规?) then (否)
      :返回长度超限错误;
      |用户|
      :显示长度限制提示;
      stop
    else (是)
      :敏感词内容检查;

      if (包含敏感词?) then (是)
        :返回内容违规错误;
        |用户|
        :显示内容违规提示;
        stop
      else (否)
        if (指定了相关食堂?) then (是)
          :验证食堂存在性;
          |数据库|
          :查询食堂信息;
          if (食堂存在?) then (否)
            |系统|
            :返回食堂不存在错误;
            |用户|
            :显示食堂不存在提示;
            stop
          endif
        endif

        |系统|
        :生成投诉建议编号;
        :设置初始状态为待处理;
        :记录提交时间;

        |数据库|
        :插入投诉建议记录;

        if (插入成功?) then (否)
          |系统|
          :返回数据库错误;
          |用户|
          :显示提交失败提示;
          stop
        else (是)
          |系统|
          :发送通知给管理员;
          :返回提交成功响应;

          |用户|
          :显示提交成功消息;
          :显示投诉编号;
          :记录到个人投诉历史;
          stop
        endif
      endif
    endif
  endif
endif

@enduml