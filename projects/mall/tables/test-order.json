{
  "id": "6.2.3",
  "title": "订单管理功能测试",
  "word_limit": 300,
  "text": "placeholder",
  "tablePath": "${tables}/test-order.json",
  "_note": "三级章节，必须有text，包含测试用例表",
  "content": "订单管理功能测试验证订单创建、支付、状态管理等核心流程，重点测试分布式事务的正确性。测试用例如表6-3所示。\n\n订单创建功能测试验证完整的下单流程。正常场景：用户登录后选择购物车商品，填写收货地址，提交订单，系统验证库存充足，预扣减库存，创建订单记录和订单详情记录，清空购物车，返回订单编号。数据库验证：订单表新增记录，订单详情表新增商品记录，库存表locked_stock增加，available_stock减少，购物车表对应商品删除。异常场景：库存不足时创建订单，系统提示库存不足，订单不创建，库存不变，购物车保持原状，验证分布式事务回滚成功。用户未登录创建订单，系统返回未授权错误。收货地址不存在，系统提示请选择收货地址。\n\n订单支付功能测试模拟支付流程。订单创建后状态为待支付，调用支付接口生成支付二维码。使用测试支付账号完成支付，支付平台回调通知系统。系统验证签名和订单信息，更新订单状态为已支付，记录支付时间，真正扣减库存（locked_stock减少）。验证数据库记录正确更新。支付超时测试：订单创建30分钟后未支付，定时任务自动取消订单，订单状态变为已取消，库存恢复（locked_stock减少，available_stock增加）。\n\n订单状态管理测试验证状态流转的正确性。发货测试：管理员对已支付订单执行发货操作，填写物流信息，订单状态更新为已发货，记录发货时间。对待支付订单发货，系统提示订单未支付不能发货。确认收货测试：用户对已发货订单确认收货，订单状态更新为已完成。对待支付订单确认收货，系统提示状态不允许。取消订单测试：用户取消待支付订单成功，库存恢复。用户取消已支付订单，系统提示已支付订单不能直接取消，需要申请退款。\n\n订单查询测试验证数据准确性。查询订单列表，支持按状态筛选，分页显示正常。查询订单详情，返回订单完整信息包括商品列表、收货地址、支付信息等。查询其他用户的订单，系统返回权限不足错误，保证数据安全。\n\n分布式事务测试是订单模块的重点。模拟商品服务调用失败场景，订单创建失败，订单表和订单详情表没有新增记录，库存不变，购物车保持原状，验证Seata分布式事务回滚成功。模拟购物车服务调用失败，整个事务回滚，数据保持一致。并发创建订单测试，多个用户同时购买最后几件库存的商品，系统正确处理，不会出现超卖，部分用户创建成功，部分用户提示库存不足。测试结果表明，订单管理功能实现完整，分布式事务保证了数据的一致性，满足电商业务需求。",
  "sourceFile": "chapter.6.2.3.json",
  "extractedAt": "2025-10-01T18:47:31.148Z"
}