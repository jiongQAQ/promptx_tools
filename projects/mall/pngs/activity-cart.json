{
  "id": "4.2.4",
  "title": "购物车模块设计",
  "word_limit": 500,
  "text": "placeholder",
  "imagePath": "${uml}/activity-cart.png",
  "imagePathSequence": "${uml}/sequence-cart.png",
  "_note": "三级章节，必须有text，包含活动图和时序图",
  "content": "购物车模块为用户提供临时存储商品的功能，是电商购物流程中的重要环节。购物车的操作流程如图4-7所示，与其他服务的交互如图4-8所示。\n\n购物车采用Redis作为主要存储方案，以提升访问性能。Redis的高性能读写能力非常适合购物车这种高频访问的场景。购物车数据以用户ID为键，购物车商品列表为值，采用Hash数据结构存储。每个商品项包含商品ID、商品名称、价格、数量、是否选中等字段。Redis中的购物车数据设置合理的过期时间，如7天，超过时间未访问的购物车数据自动清理，节省存储空间。\n\n添加商品到购物车时，系统首先验证用户登录状态。用户选择商品和数量后，系统调用商品服务获取商品的最新价格和库存信息。如果商品已在购物车中，则增加商品数量；如果是新商品，则添加到购物车列表。系统实时计算购物车中所有商品的总价，返回给前端展示。对于未登录用户，购物车数据暂存在浏览器本地存储（LocalStorage）中，用户登录后，系统将本地购物车数据合并到Redis中，实现购物车数据的同步。\n\n修改商品数量是购物车的常用操作。用户可以增加或减少商品数量，系统更新Redis中对应商品的数量字段。如果数量减少为0，则从购物车中删除该商品。系统对商品数量进行校验，数量不能超过库存，也不能超过单次购买限制（如单个商品最多购买99件）。数量修改后，系统重新计算购物车总价。\n\n删除商品操作允许用户从购物车中移除不需要的商品。系统从Redis中删除对应的商品项，更新购物车状态。系统也支持清空购物车操作，一次性删除所有商品。\n\n查询购物车时，系统从Redis中读取购物车数据，调用商品服务获取商品的最新价格和库存状态。如果商品已下架或库存不足，系统在购物车中标记该商品，提示用户该商品无法购买。购物车列表按添加时间倒序排列，最新添加的商品显示在最前面。\n\n购物车结算时，系统获取用户选中的商品列表，传递给订单服务创建订单。订单创建成功后，购物车服务清空已结算的商品。\n\n为保证数据不丢失，系统采用双写机制：购物车数据除了写入Redis，还异步写入MySQL数据库。用户登录时，如果Redis中没有购物车数据，从MySQL中加载。这种设计兼顾了性能和数据可靠性，确保用户购物车数据不会因Redis数据丢失而丢失。",
  "sourceFile": "chapter.4.2.4.json",
  "extractedAt": "2025-10-01T18:47:31.144Z"
}