@startuml software-architecture

skinparam linetype ortho
skinparam nodesep 100
skinparam ranksep 100
!define RECTANGLE class

skinparam packageStyle rectangle
skinparam componentStyle rectangle

title 电商系统五层架构

package "前端层 (Presentation Layer)" #LightBlue {
  component [用户端应用\n(Vue.js)] as UserApp
  component [管理端应用\n(Vue.js)] as AdminApp
}

package "网关层 (Gateway Layer)" #LightGreen {
  component [Spring Cloud Gateway\n- 路由转发\n- 负载均衡\n- JWT认证\n- 限流控制] as Gateway
}

package "服务层 (Service Layer)" #LightYellow {
  component [用户服务\n(User Service)] as UserService
  component [商品服务\n(Goods Service)] as GoodsService
  component [订单服务\n(Order Service)] as OrderService
  component [购物车服务\n(Cart Service)] as CartService
  component [推荐服务\n(Recommend Service)] as RecommendService
}

package "数据层 (Data Layer)" #LightPink {
  database "MySQL\n(用户库)" as UserDB
  database "MySQL\n(商品库)" as GoodsDB
  database "MySQL\n(订单库)" as OrderDB
  database "MySQL\n(购物车库)" as CartDB
  database "MySQL\n(推荐库)" as RecommendDB
  database "Redis\n(缓存)" as Redis
}

package "基础设施层 (Infrastructure Layer)" #LightGray {
  component [Nacos\n- 服务注册\n- 配置中心] as Nacos
  component [Sentinel\n- 流量控制\n- 熔断降级] as Sentinel
  component [Seata\n- 分布式事务] as Seata
  component [RabbitMQ\n- 消息队列] as MQ
}

UserApp -down-> Gateway : HTTP
AdminApp -down-> Gateway : HTTP

Gateway -down-> UserService : OpenFeign
Gateway -down-> GoodsService : OpenFeign
Gateway -down-> OrderService : OpenFeign
Gateway -down-> CartService : OpenFeign
Gateway -down-> RecommendService : OpenFeign

UserService -down-> UserDB : MyBatis
GoodsService -down-> GoodsDB : MyBatis
OrderService -down-> OrderDB : MyBatis
CartService -down-> CartDB : MyBatis
RecommendService -down-> RecommendDB : MyBatis

UserService -down-> Redis
GoodsService -down-> Redis
OrderService -down-> Redis
CartService -down-> Redis
RecommendService -down-> Redis

UserService .up.> Nacos : 注册/发现
GoodsService .up.> Nacos : 注册/发现
OrderService .up.> Nacos : 注册/发现
CartService .up.> Nacos : 注册/发现
RecommendService .up.> Nacos : 注册/发现

OrderService -down-> Seata : 分布式事务
Gateway -down-> Sentinel : 流量控制
OrderService .down.> MQ : 异步消息

OrderService --> GoodsService : 库存查询
OrderService --> UserService : 用户验证
OrderService --> CartService : 清空购物车
RecommendService --> GoodsService : 商品信息

@enduml
