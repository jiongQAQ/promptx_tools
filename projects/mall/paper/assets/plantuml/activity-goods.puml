@startuml activity-goods

<<<<<<< HEAD
skinparam linetype ortho
skinparam nodesep 100
skinparam ranksep 100
=======
!pragma layout smetana
skinparam linetype ortho
skinparam nodesep 80
skinparam ranksep 80
>>>>>>> 32c2d4b6a4b90edef88800c5b58783d709691097

title 商品管理模块业务流程

|管理员|
start

if (操作类型?) then (商品管理)

  if (管理操作?) then (添加商品)
    :填写商品信息;
    :上传商品图片;

    |系统|
    :验证必填字段;
    :保存图片到文件服务器;
    :插入商品记录;
    :更新Redis缓存;
    :添加成功;

  else if (编辑商品)
    |管理员|
    :修改商品信息;

    |系统|
    :更新商品记录;
    :删除Redis缓存;
    :更新成功;

  else if (上下架)
    |系统|
    :修改商品状态;
    :删除Redis缓存;
    :操作成功;

  else (删除商品)
    |系统|
    :逻辑删除\n(标记isDeleted);
    :删除Redis缓存;
    :删除成功;
  endif

else if (分类管理)

  if (分类操作?) then (添加分类)
    |管理员|
    :输入分类信息;

    |系统|
    :创建分类记录;
    :构建分类树;

  else if (编辑分类)
    :修改分类信息;
    :更新分类树;

  else (删除分类)
    :检查是否有商品;

    if (有商品?) then (yes)
      :返回"不能删除";
      stop
    else (no)
      :删除分类;
    endif
  endif

else (商品查询)

  |用户|
  :选择查询方式;

  if (查询方式?) then (列表查询)
    |系统|
    :按分类/价格筛选;
    :分页查询;
    :查询Redis缓存;

    if (缓存命中?) then (yes)
      :返回缓存数据;
    else (no)
      :查询MySQL;
      :写入Redis;
      :返回数据;
    endif

  else if (详情查询)
    :查询商品完整信息;
    :返回详情;

  else (搜索)
    |用户|
    :输入关键词;

    |系统|
    :模糊匹配商品名称/描述;
    :关键词高亮;
    :返回搜索结果;
  endif

endif

stop

@enduml
