@startuml er-overall

skinparam linetype ortho
skinparam nodesep 80
skinparam ranksep 100

title 电商系统整体E-R图

' ========== 用户服务实体 ==========
entity "用户\n(MallUser)" as User {
  * userId : BIGINT <<PK>>
  --
  * nickName : VARCHAR(50)
  * loginName : VARCHAR(50) <<UK>>
  * passwordMd5 : VARCHAR(100)
  introduceSign : VARCHAR(200)
  isDeleted : TINYINT
  lockedFlag : TINYINT
  createTime : DATETIME
}

entity "管理员用户\n(AdminUser)" as AdminUser {
  * adminUserId : BIGINT <<PK>>
  --
  * loginUserName : VARCHAR(50) <<UK>>
  * loginPassword : VARCHAR(100)
  * nickName : VARCHAR(50)
  locked : TINYINT
}

entity "用户地址\n(UserAddress)" as UserAddress {
  * addressId : BIGINT <<PK>>
  --
  * userId : BIGINT <<FK>>
  * userName : VARCHAR(30)
  * userPhone : VARCHAR(11)
  * provinceName : VARCHAR(32)
  * cityName : VARCHAR(32)
  * regionName : VARCHAR(32)
  * detailAddress : VARCHAR(200)
  isDefault : TINYINT
  createTime : DATETIME
}

' ========== 商品服务实体 ==========
entity "商品信息\n(GoodsInfo)" as Goods {
  * goodsId : BIGINT <<PK>>
  --
  * goodsName : VARCHAR(200)
  * goodsIntro : VARCHAR(200)
  * goodsCategoryId : BIGINT <<FK>>
  * goodsCoverImg : VARCHAR(200)
  goodsCarousel : VARCHAR(500)
  * originalPrice : INT
  * sellingPrice : INT
  * stockNum : INT
  tag : VARCHAR(20)
  * goodsSellStatus : TINYINT
  goodsDetailContent : TEXT
  createTime : DATETIME
  updateTime : DATETIME
}

entity "商品分类\n(GoodsCategory)" as Category {
  * categoryId : BIGINT <<PK>>
  --
  * categoryLevel : TINYINT
  parentId : BIGINT <<FK>>
  * categoryName : VARCHAR(50)
  * categoryRank : INT
  isDeleted : TINYINT
  createTime : DATETIME
  updateTime : DATETIME
}

' ========== 订单服务实体 ==========
entity "订单\n(Order)" as Order {
  * orderId : BIGINT <<PK>>
  --
  * orderNo : VARCHAR(20) <<UK>>
  * userId : BIGINT <<FK>>
  * totalPrice : INT
  * payStatus : TINYINT
  payType : TINYINT
  payTime : DATETIME
  * orderStatus : TINYINT
  extraInfo : VARCHAR(100)
  isDeleted : TINYINT
  createTime : DATETIME
  updateTime : DATETIME
}

entity "订单明细\n(OrderItem)" as OrderItem {
  * orderItemId : BIGINT <<PK>>
  --
  * orderId : BIGINT <<FK>>
  * goodsId : BIGINT
  * goodsName : VARCHAR(200)
  * goodsCoverImg : VARCHAR(200)
  * sellingPrice : INT
  * goodsCount : INT
  createTime : DATETIME
}

entity "订单地址\n(OrderAddress)" as OrderAddress {
  * addressId : BIGINT <<PK>>
  --
  * orderId : BIGINT <<FK>>
  * userName : VARCHAR(30)
  * userPhone : VARCHAR(11)
  * provinceName : VARCHAR(32)
  * cityName : VARCHAR(32)
  * regionName : VARCHAR(32)
  * detailAddress : VARCHAR(200)
}

' ========== 购物车服务实体 ==========
entity "购物车\n(ShoppingCartItem)" as Cart {
  * cartItemId : BIGINT <<PK>>
  --
  * userId : BIGINT <<FK>>
  * goodsId : BIGINT <<FK>>
  * goodsCount : INT
  isDeleted : TINYINT
  createTime : DATETIME
  updateTime : DATETIME
}

' ========== 推荐服务实体 ==========
entity "轮播图\n(Carousel)" as Carousel {
  * carouselId : BIGINT <<PK>>
  --
  * carouselUrl : VARCHAR(100)
  redirectUrl : VARCHAR(100)
  * carouselRank : INT
  isDeleted : TINYINT
  createTime : DATETIME
  updateTime : DATETIME
}

entity "首页配置\n(IndexConfig)" as IndexConfig {
  * configId : BIGINT <<PK>>
  --
  * configName : VARCHAR(50)
  * configType : TINYINT
  goodsId : BIGINT <<FK>>
  redirectUrl : VARCHAR(100)
  * configRank : INT
  isDeleted : TINYINT
  createTime : DATETIME
  updateTime : DATETIME
}

' ========== 实体关系 ==========
User ||--o{ UserAddress : "拥有"
User ||--o{ Order : "下单"
User ||--o{ Cart : "添加"

Category ||--o{ Goods : "分类"
Category ||--o{ Category : "父子分类"

Goods ||--o{ OrderItem : "购买"
Goods ||--o{ Cart : "加入购物车"
Goods ||--o{ IndexConfig : "推荐"

Order ||--|{ OrderItem : "包含"
Order ||--|| OrderAddress : "配送到"

note right of User
  用户服务数据库
  newbee_mall_cloud_user_db
end note

note right of Goods
  商品服务数据库
  newbee_mall_cloud_goods_db
end note

note right of Order
  订单服务数据库
  newbee_mall_cloud_order_db
end note

note right of Cart
  购物车服务数据库
  newbee_mall_cloud_cart_db
end note

note right of Carousel
  推荐服务数据库
  newbee_mall_cloud_recommend_db
end note

@enduml
