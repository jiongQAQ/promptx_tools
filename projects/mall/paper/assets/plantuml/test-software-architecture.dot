digraph software_architecture {
    // 图的全局设置
    graph [
        rankdir=TB
        nodesep=2.0
        ranksep=3.0
        pad=1.5
        dpi=300
        splines=ortho
        bgcolor=white
    ];

    // 节点默认设置
    node [
        fontname="Microsoft YaHei"
        fontsize=18
    ];

    // 边默认设置
    edge [
        fontname="Microsoft YaHei"
        fontsize=15
        labeldistance=2.5
    ];

    // ========== 前端层 ==========
    subgraph cluster_frontend {
        label="前端层 (Presentation Layer)"
        style=filled
        fillcolor="#E6F3FF"

        UserApp [label="用户端应用\n(Vue.js H5)" shape=box width=2.5 height=1.0];
        AdminApp [label="管理端应用\n(Vue.js PC)" shape=box width=2.5 height=1.0];
    }

    // ========== 网关层 ==========
    subgraph cluster_gateway {
        label="网关层 (Gateway Layer)"
        style=filled
        fillcolor="#FFF4E6"

        UserGateway [label="用户端网关\n(Spring Cloud Gateway)" shape=box width=3.0 height=1.0];
        AdminGateway [label="管理端网关\n(Spring Cloud Gateway)" shape=box width=3.0 height=1.0];
    }

    // ========== 服务层 ==========
    subgraph cluster_services {
        label="服务层 (Service Layer)"
        style=filled
        fillcolor="#E8F5E9"

        UserService [label="用户服务\n(User Service)" shape=ellipse width=2.5 height=1.2];
        GoodsService [label="商品服务\n(Goods Service)" shape=ellipse width=2.5 height=1.2];
        OrderService [label="订单服务\n(Order Service)" shape=ellipse width=2.5 height=1.2];
        CartService [label="购物车服务\n(Cart Service)" shape=ellipse width=2.5 height=1.2];
        RecommendService [label="推荐服务\n(Recommend Service)" shape=ellipse width=2.5 height=1.2];
    }

    // ========== 数据层 ==========
    subgraph cluster_data {
        label="数据层 (Data Layer)"
        style=filled
        fillcolor="#FCE4EC"

        UserDB [label="用户数据库\n(MySQL)" shape=cylinder width=2.0 height=1.0];
        GoodsDB [label="商品数据库\n(MySQL)" shape=cylinder width=2.0 height=1.0];
        OrderDB [label="订单数据库\n(MySQL)" shape=cylinder width=2.0 height=1.0];
        CartDB [label="购物车数据库\n(MySQL)" shape=cylinder width=2.0 height=1.0];
        RecommendDB [label="推荐数据库\n(MySQL)" shape=cylinder width=2.0 height=1.0];
        Redis [label="Redis缓存" shape=cylinder width=2.0 height=1.0];
    }

    // ========== 基础设施层 ==========
    subgraph cluster_infra {
        label="基础设施层 (Infrastructure Layer)"
        style=filled
        fillcolor="#F3E5F5"

        Nacos [label="Nacos\n服务注册与配置" shape=box width=2.5 height=1.0];
        Sentinel [label="Sentinel\n流量控制" shape=box width=2.5 height=1.0];
        Seata [label="Seata\n分布式事务" shape=box width=2.5 height=1.0];
    }

    // ========== 前端层 -> 网关层 ==========
    UserApp -> UserGateway [label="HTTP请求"];
    AdminApp -> AdminGateway [label="HTTP请求"];

    // ========== 网关层 -> 服务层 ==========
    UserGateway -> UserService [label="路由转发"];
    UserGateway -> GoodsService [label="路由转发"];
    UserGateway -> OrderService [label="路由转发"];
    UserGateway -> CartService [label="路由转发"];
    UserGateway -> RecommendService [label="路由转发"];

    AdminGateway -> UserService [label="路由转发"];
    AdminGateway -> GoodsService [label="路由转发"];
    AdminGateway -> OrderService [label="路由转发"];

    // ========== 服务层内部调用 ==========
    OrderService -> UserService [label="验证用户" style=dashed];
    OrderService -> GoodsService [label="检查库存" style=dashed];
    OrderService -> CartService [label="清空购物车" style=dashed];
    RecommendService -> GoodsService [label="获取商品信息" style=dashed];

    // ========== 服务层 -> 数据层 ==========
    UserService -> UserDB [label="数据访问"];
    GoodsService -> GoodsDB [label="数据访问"];
    OrderService -> OrderDB [label="数据访问"];
    CartService -> CartDB [label="数据访问"];
    RecommendService -> RecommendDB [label="数据访问"];

    UserService -> Redis [label="缓存操作" style=dashed];
    GoodsService -> Redis [label="缓存操作" style=dashed];
    CartService -> Redis [label="缓存操作" style=dashed];
    RecommendService -> Redis [label="缓存操作" style=dashed];

    // ========== 服务层 -> 基础设施层 ==========
    {UserService GoodsService OrderService CartService RecommendService} -> Nacos [label="服务注册" style=dotted dir=both];
    {UserService GoodsService OrderService CartService RecommendService} -> Sentinel [label="流量控制" style=dotted];
    OrderService -> Seata [label="分布式事务" style=dotted];
}
