{
  "id": "4.3.2",
  "title": "商品管理模块设计",
  "word_limit": 500,
  "text": "placeholder",
  "imagePath": "${uml}/activity-goods.png",
  "imagePathSequence": "${uml}/sequence-goods.png",
  "_note": "三级章节,必须有text,包含活动图和时序图",
  "content": "商品管理模块是系统的核心业务模块,为用户提供商品信息管理、分类管理、库存管理、商品查询等功能。模块的业务流程如图4-3所示,服务间交互如图4-4所示。",
  "code": "/**\n * 更新商品库存\n * 订单支付成功后扣减库存\n */\n@Override\n@Transactional\npublic void updateStockNum(List<StockNumDTO> stockNumDTOS) {\n    if (CollectionUtils.isEmpty(stockNumDTOS)) {\n        NewBeeMallException.fail(ServiceResultEnum.PARAM_ERROR.getResult());\n    }\n    for (StockNumDTO stockNumDTO : stockNumDTOS) {\n        NewBeeMallGoods newBeeMallGoods = newBeeMallGoodsMapper.selectByPrimaryKey(stockNumDTO.getGoodsId());\n        Integer stockNum = newBeeMallGoods.getStockNum();\n        if (stockNum < stockNumDTO.getGoodsCount()) {\n            NewBeeMallException.fail(ServiceResultEnum.GOODS_STOCK_ERROR.getResult());\n        }\n        // 扣减库存\n        if (newBeeMallGoodsMapper.updateStockNum(stockNumDTOS) < 1) {\n            NewBeeMallException.fail(ServiceResultEnum.GOODS_STOCK_ERROR.getResult());\n        }\n    }\n}\n\n/**\n * 恢复商品库存\n * 订单取消时恢复已扣减的库存\n */\n@Override\n@Transactional\npublic void restoreStock(List<StockNumDTO> stockNumDTOS) {\n    if (CollectionUtils.isEmpty(stockNumDTOS)) {\n        NewBeeMallException.fail(ServiceResultEnum.PARAM_ERROR.getResult());\n    }\n    for (StockNumDTO stockNumDTO : stockNumDTOS) {\n        NewBeeMallGoods newBeeMallGoods = newBeeMallGoodsMapper.selectByPrimaryKey(stockNumDTO.getGoodsId());\n        if (newBeeMallGoods == null) {\n            NewBeeMallException.fail(ServiceResultEnum.GOODS_NOT_EXIST.getResult());\n        }\n        // 恢复库存\n        if (newBeeMallGoodsMapper.restoreStock(stockNumDTOS) < 1) {\n            NewBeeMallException.fail(ServiceResultEnum.OPERATE_ERROR.getResult());\n        }\n    }\n}"
}