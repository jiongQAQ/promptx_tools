{
  "id": "5.2.1",
  "title": "用户管理模块实现",
  "word_limit": 600,
  "text": "placeholder",
  "imagePath": "${impl}/impl-user.png",
  "_note": "三级章节，必须有text，包含实现截图",
  "content": "用户管理模块的实现基于Spring Boot框架，采用SSM架构组织代码。模块实现效果如图5-1所示。\n\n数据库设计方面，用户表user包含id、username、password、phone、email、avatar、create_time等字段。id作为主键，采用自增长策略。password字段存储加密后的密码。地址表address包含id、user_id、receiver、phone、province、city、district、detail、is_default等字段，通过user_id关联用户表。角色表role和权限表permission实现RBAC权限模型，用户角色关联表user_role建立用户和角色的多对多关系。\n\n实体类设计使用Lombok注解简化代码。User类添加@Data注解自动生成getter、setter方法，@TableName注解指定数据库表名。密码字段使用@JsonIgnore注解，防止密码信息被序列化到JSON响应中。Address类包含完整的地址信息字段，提供getter和setter方法。\n\nMapper层使用MyBatis-Plus框架实现数据访问。UserMapper接口继承BaseMapper<User>，自动获得CRUD方法。自定义方法通过@Select注解编写SQL语句，如根据手机号查询用户：@Select(\"SELECT * FROM user WHERE phone = #{phone}\")。AddressMapper提供地址的增删改查功能，根据用户ID查询地址列表的方法使用@Select注解实现。MyBatis-Plus的条件构造器QueryWrapper用于构建复杂查询条件，避免编写繁琐的SQL语句。\n\nService层实现业务逻辑。UserService接口定义用户相关的业务方法，UserServiceImpl实现类添加@Service注解注册为Spring Bean。注册方法首先检查手机号是否已存在，如果存在则抛出业务异常。验证码校验从Redis中获取验证码进行比对，验证通过后使用BCryptPasswordEncoder对密码进行加密。创建用户对象，设置各字段值，调用userMapper.insert()方法插入数据库。登录方法根据用户名或手机号查询用户，使用passwordEncoder.matches()方法验证密码，验证通过后使用JWT工具类生成token。token中包含用户ID、角色等信息，设置有效期为7天。地址管理方法包括添加地址、修改地址、删除地址、设置默认地址等，每个方法都进行用户权限校验，确保用户只能操作自己的地址。\n\nController层提供RESTful API接口。UserController类添加@RestController和@RequestMapping(\"/api/user\")注解，定义接口路径前缀。注册接口使用@PostMapping(\"/register\")注解，接收RegisterDTO参数，调用userService.register()方法完成注册，返回统一响应格式Result对象。登录接口返回token给客户端，客户端保存token在localStorage中。获取用户信息接口通过@GetMapping(\"/info\")定义，从请求Header中解析JWT token获取用户ID，根据ID查询用户信息返回。修改用户信息接口使用@PutMapping(\"/update\")，接收用户提交的信息，更新数据库记录。地址管理接口包括添加地址POST /address、地址列表GET /address/list、修改地址PUT /address/{id}、删除地址DELETE /address/{id}等。\n\n权限控制通过网关过滤器实现。网关解析请求中的JWT token，验证token的有效性和签名，提取用户ID和角色信息，存入请求Header传递给下游服务。服务接收到请求后，从Header中获取用户信息，进行业务级别的权限校验。Spring Security集成提供更细粒度的权限控制，通过@PreAuthorize注解标注方法需要的权限。\n\n异常处理采用全局异常处理器。@ControllerAdvice注解的类捕获所有Controller抛出的异常，根据异常类型返回相应的错误信息。业务异常返回业务错误码和错误消息，系统异常记录日志并返回通用错误信息，避免敏感信息泄露。用户管理模块的实现为系统提供了完善的用户认证和授权功能，保障了系统的安全性。"
}