{
  "id": "4.3.5",
  "title": "首页推荐模块设计",
  "word_limit": 500,
  "text": "placeholder",
  "imagePath": "${uml}/activity-recommend.png",
  "imagePathSequence": "${uml}/sequence-recommend.png",
  "_note": "三级章节,必须有text,包含活动图和时序图",
  "content": "首页推荐模块是系统的增强功能模块,为用户提供热门推荐、新品推荐、个性化推荐、分类推荐等功能。推荐流程如图4-9所示,服务交互如图4-10所示。",
  "code": "/**\n * 获取首页轮播图\n * 返回用于首页展示的轮播图列表\n */\n@Override\npublic List<NewBeeMallIndexCarouselVO> getCarouselsForIndex(int number) {\n    List<Carousel> carousels = carouselMapper.findCarouselsByNum(number);\n    List<NewBeeMallIndexCarouselVO> newBeeMallIndexCarouselVOS = new ArrayList<>(number);\n    BeanUtil.copyList(carousels, newBeeMallIndexCarouselVOS);\n    return newBeeMallIndexCarouselVOS;\n}\n\n/**\n * 获取首页热销商品\n * 返回销量最高的商品列表用于首页推荐\n */\n@Override\npublic List<NewBeeMallIndexConfigGoodsVO> getConfigGoodsForIndex(\n    IndexConfigTypeEnum configType, int number) {\n    List<IndexConfig> indexConfigs = indexConfigMapper.findIndexConfigsByTypeAndNum(\n        configType.getType(), number);\n    if (CollectionUtils.isEmpty(indexConfigs)) {\n        return null;\n    }\n    // 取出所有商品ID\n    List<Long> goodsIds = indexConfigs.stream()\n        .map(IndexConfig::getGoodsId).collect(Collectors.toList());\n    // 通过Feign调用商品服务获取商品详情\n    Result<List<NewBeeMallGoodsDTO>> newBeeMallGoodsDTOResult = \n        newBeeMallGoodsServiceFeign.listByGoodsIds(goodsIds);\n    List<NewBeeMallIndexConfigGoodsVO> newBeeMallIndexConfigGoodsVOS = new ArrayList<>();\n    if (newBeeMallGoodsDTOResult.getResultCode() == 200) {\n        List<NewBeeMallGoodsDTO> newBeeMallGoodsDTOS = newBeeMallGoodsDTOResult.getData();\n        newBeeMallIndexConfigGoodsVOS = BeanUtil.copyList(newBeeMallGoodsDTOS, \n            NewBeeMallIndexConfigGoodsVO.class);\n        for (NewBeeMallIndexConfigGoodsVO newBeeMallIndexConfigGoodsVO : newBeeMallIndexConfigGoodsVOS) {\n            String goodsName = newBeeMallIndexConfigGoodsVO.getGoodsName();\n            String goodsIntro = newBeeMallIndexConfigGoodsVO.getGoodsIntro();\n            // 字符串过长导致文字超出的问题\n            if (goodsName.length() > 30) {\n                goodsName = goodsName.substring(0, 30) + \"...\";\n                newBeeMallIndexConfigGoodsVO.setGoodsName(goodsName);\n            }\n            if (goodsIntro.length() > 22) {\n                goodsIntro = goodsIntro.substring(0, 22) + \"...\";\n                newBeeMallIndexConfigGoodsVO.setGoodsIntro(goodsIntro);\n            }\n        }\n    }\n    return newBeeMallIndexConfigGoodsVOS;\n}"
}