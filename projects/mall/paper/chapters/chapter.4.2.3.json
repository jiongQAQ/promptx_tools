{
  "id": "4.2.3",
  "title": "订单管理模块设计",
  "word_limit": 500,
  "text": "placeholder",
  "imagePath": "${uml}/activity-order.png",
  "imagePathSequence": "${uml}/sequence-order.png",
  "_note": "三级章节，必须有text，包含活动图和时序图",
  "content": "订单管理模块是电商系统的核心业务模块，负责处理从下单到完成的整个订单生命周期。订单业务流程如图4-5所示，服务间协作时序如图4-6所示。\n\n订单创建是订单流程的起点，涉及多个服务的协同操作。用户在购物车选择商品后点击结算，系统首先调用用户服务验证用户登录状态和收货地址信息。然后调用商品服务检查商品库存是否充足，如果库存不足则提示用户库存不足，无法下单。库存充足时，系统预扣减库存，将库存数量减少但订单状态标记为待支付。系统创建订单记录，包括订单编号、用户信息、商品信息、收货地址、订单金额、创建时间等。订单编号采用分布式ID生成算法，保证全局唯一性。订单创建成功后，调用购物车服务清空对应商品。整个过程需要使用Seata分布式事务保证，任何环节失败都要回滚所有操作。\n\n订单支付流程在订单创建后触发。系统为用户生成支付二维码或跳转到支付页面，用户选择支付方式（如微信支付、支付宝）完成支付。支付成功后，第三方支付平台通过回调接口通知系统。系统验证回调签名，确认支付金额和订单信息无误后，更新订单状态为已支付，真正扣减商品库存。如果用户在规定时间内（如30分钟）未支付，系统定时任务自动取消订单，恢复预扣减的库存。\n\n订单状态管理贯穿订单的整个生命周期。订单状态包括：待支付、已支付、待发货、已发货、待收货、已完成、已取消、退款中、已退款等。状态之间的流转遵循严格的规则，如已完成的订单不能取消，已发货的订单需要等待用户确认收货。系统提供订单查询接口，支持按订单状态、创建时间、用户ID等条件查询订单列表，支持分页显示。\n\n订单发货由管理员在后台操作。管理员选择订单，填写物流公司和物流单号，更新订单状态为已发货。系统记录发货时间，用户可以通过物流单号查询物流信息。订单到达后，用户点击确认收货，订单状态变更为已完成。系统也支持自动确认收货，如果用户在发货后15天内未操作，系统自动确认收货。\n\n订单服务的数据库设计包括订单主表和订单详情表。订单主表存储订单的基本信息，订单详情表存储订单中的商品列表，一个订单对应多个商品。通过订单ID关联两个表，实现订单信息的完整存储。"
}