{
  "id": "4.3.4",
  "title": "购物车模块设计",
  "word_limit": 500,
  "text": "placeholder",
  "imagePath": "${uml}/activity-cart.png",
  "imagePathSequence": "${uml}/sequence-cart.png",
  "_note": "三级章节,必须有text,包含活动图和时序图",
  "content": "购物车模块是系统的辅助功能模块,为用户提供添加商品、修改数量、删除商品、查询购物车等功能。购物车的操作流程如图4-7所示,与其他服务的交互如图4-8所示。",
  "code": "/**\n * 添加商品到购物车\n * 通过Feign调用商品服务验证商品信息\n */\n@Override\npublic String saveNewBeeMallCartItem(SaveCartItemParam saveCartItemParam, Long userId) {\n    // 检查购物车中是否已存在该商品\n    NewBeeMallShoppingCartItem temp = newBeeMallShoppingCartItemMapper\n        .selectByUserIdAndGoodsId(userId, saveCartItemParam.getGoodsId());\n    if (temp != null) {\n        NewBeeMallException.fail(ServiceResultEnum.SHOPPING_CART_ITEM_EXIST_ERROR.getResult());\n    }\n    \n    // 通过Feign调用商品服务获取商品详情\n    Result<NewBeeMallGoodsDTO> goodsDetailResult = \n        goodsService.getGoodsDetail(saveCartItemParam.getGoodsId());\n    if (goodsDetailResult == null || goodsDetailResult.getResultCode() != 200) {\n        return ServiceResultEnum.GOODS_NOT_EXIST.getResult();\n    }\n    int totalItem = newBeeMallShoppingCartItemMapper.selectCountByUserId(userId);\n    \n    // 购物车商品数量限制判断\n    if (totalItem > Constants.SHOPPING_CART_ITEM_LIMIT_NUMBER) {\n        return ServiceResultEnum.SHOPPING_CART_ITEM_LIMIT_ERROR.getResult();\n    }\n    \n    NewBeeMallGoodsDTO newBeeMallGoodsDTO = goodsDetailResult.getData();\n    // 判断商品上下架状态\n    if (newBeeMallGoodsDTO.getGoodsSellStatus() != Constants.SELL_STATUS_UP) {\n        return ServiceResultEnum.GOODS_PUT_DOWN.getResult();\n    }\n    \n    // 保存购物车商品\n    NewBeeMallShoppingCartItem newBeeMallShoppingCartItem = new NewBeeMallShoppingCartItem();\n    BeanUtil.copyProperties(saveCartItemParam, newBeeMallShoppingCartItem);\n    newBeeMallShoppingCartItem.setUserId(userId);\n    if (newBeeMallShoppingCartItemMapper.insertSelective(newBeeMallShoppingCartItem) > 0) {\n        return ServiceResultEnum.SUCCESS.getResult();\n    }\n    return ServiceResultEnum.DB_ERROR.getResult();\n}"
}