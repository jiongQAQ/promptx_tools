{
  "id": "5.2.4",
  "title": "购物车模块实现",
  "word_limit": 500,
  "text": "placeholder",
  "imagePath": "${impl}/impl-cart.png",
  "_note": "三级章节，必须有text，包含实现截图",
  "content": "购物车模块采用Redis作为主存储，MySQL作为备份存储的双写策略，保证高性能和数据可靠性。模块实现效果如图5-4所示。\n\n数据库设计包含购物车表，存储用户购物车商品信息。表中记录用户标识、商品标识、商品数量、选中状态等字段。通过联合唯一约束防止用户重复添加相同商品。\n\nRedis存储设计采用Hash数据结构，按用户组织购物车数据。这种设计支持快速的增删改查操作，获取整个购物车和修改单个商品都很高效。设置合理的过期时间并自动刷新。\n\n业务逻辑层实现购物车核心功能。添加商品方法从Redis获取购物车数据，商品已存在时数量累加，新商品则添加到购物车。调用商品服务获取最新价格和库存验证可用性。更新Redis数据并异步写入MySQL保证持久化。计算购物车总价返回。\n\n修改商品数量方法验证数量合法性，不超过库存且大于零。更新Redis和MySQL中的数量，数量为零时等同于删除商品。删除和清空操作同步更新Redis和MySQL。\n\n查询购物车方法优先从Redis获取，不存在时从MySQL加载并写入Redis。遍历购物车商品调用商品服务批量查询最新信息，商品下架或库存不足时进行标记提示。计算选中商品总价并按时间排序返回。\n\n选中状态管理实现全选、全不选和单个商品选中切换功能，Redis和MySQL同步更新。\n\n购物车合并处理用户登录场景。未登录时购物车存储在浏览器本地，登录后前端提交本地数据给后端。后端获取用户原有购物车，合并本地购物车商品，已存在商品累加数量，新商品添加到购物车。返回最新购物车数据，前端清空本地缓存。\n\nAPI接口层提供购物车操作服务。实现添加商品、查询购物车、修改数量、删除商品、清空购物车、切换选中状态等接口。购物车模块通过Redis缓存提供了高性能的操作体验。"
}
