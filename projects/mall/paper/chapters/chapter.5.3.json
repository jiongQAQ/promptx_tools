{
  "id": "5.3",
  "title": "微服务治理与基础设施实现",
  "word_limit": 900,
  "text": "placeholder",
  "_note": "二级章节，无子节点，需要text，包含配置示例",
  "content": "微服务治理的实现依托Spring Cloud Alibaba核心组件，通过配置和编码实现服务注册与发现、配置管理、流量控制、熔断降级、分布式事务等关键功能。\n\nNacos服务注册与发现的实现通过配置文件完成。每个微服务启动时，通过bootstrap.yml配置Nacos服务器地址和应用名称，自动向Nacos注册服务信息。Nacos提供健康检查机制，定期探测服务实例存活状态，自动剔除不可用实例。服务调用通过OpenFeign实现，定义Feign客户端接口，使用@FeignClient注解指定目标服务名称。Feign自动从Nacos获取服务实例列表，使用Ribbon负载均衡选择实例调用。Nacos支持服务分组和命名空间，按环境（开发、测试、生产）隔离服务，避免不同环境相互干扰。\n\nNacos配置中心提供集中化配置管理。在bootstrap.yml中配置配置中心地址和文件格式，服务启动时从Nacos加载配置。配置以Key-Value形式存储，支持Properties、YAML、JSON等格式。配置动态刷新通过@RefreshScope注解实现，在需要动态刷新的Bean上添加此注解，Nacos配置更新后Spring自动重新创建Bean实例加载新配置。配置支持版本管理和灰度发布，可回滚到历史版本，降低配置变更风险。\n\nAPI网关使用Spring Cloud Gateway实现，作为系统统一入口。在application.yml中定义路由规则，每个路由包含id、uri、predicates、filters等配置。uri支持lb://service-name格式自动从Nacos获取服务实例。predicates定义路由匹配条件，如Path=/api/user/**匹配用户服务请求。自定义过滤器实现JWT认证，继承AbstractGatewayFilterFactory，解析JWT token验证有效性，提取用户信息传递给下游服务。全局过滤器实现统一异常处理、日志记录、跨域配置等功能。\n\nSentinel流量控制和熔断降级保护服务稳定性。引入Sentinel依赖，配置Dashboard地址。使用@SentinelResource注解标注需要保护的方法，指定资源名称和降级方法。限流规则在Sentinel Dashboard配置，设置QPS阈值、限流模式等，规则持久化到Nacos。熔断降级规则配置慢调用比例、异常比例等熔断条件。当条件触发时Sentinel熔断该资源调用，执行降级方法返回默认值。熔断器有开启、关闭、半开三种状态，熔断开启后经过一段时间进入半开状态尝试恢复。系统负载保护根据CPU使用率、响应时间等指标自适应流控，保护系统不被压垮。\n\nSeata分布式事务实现数据一致性保障。配置Seata客户端指定事务分组和注册中心。在需要分布式事务的方法上添加@GlobalTransactional注解，Seata自动开启全局事务。方法内部调用其他服务接口自动注册为分布式事务分支。所有分支成功则提交全局事务，任何分支失败则通过undo log自动回滚各分支数据变更。本系统主要使用AT模式，对业务代码侵入性最小。\n\n微服务监控采用Spring Boot Actuator和Prometheus。每个微服务引入Actuator依赖，暴露健康检查和指标采集端点。Prometheus定时采集指标数据，Grafana连接Prometheus配置监控面板，展示QPS、响应时间、错误率、JVM内存等关键指标。告警规则在Prometheus配置，指标异常时触发告警通知运维人员。日志采集使用ELK方案，Filebeat采集日志发送到Logstash，Logstash解析转换后输出到Elasticsearch，Kibana提供日志查询和可视化。链路追踪使用Sleuth和Zipkin，为每个请求生成唯一Trace ID，记录请求在各服务间的调用链路和耗时，帮助定位性能瓶颈。"
}
